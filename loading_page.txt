select
    (select value.string_value from unnest(event_params) where event_name = 'page_view' and key = 'page_title') as page_title,
    case when (select value.int_value from unnest(event_params) where event_name = 'page_view' and key = 'entrances') = 1 then (select value.string_value from unnest(event_params) where event_name = 'page_view' and key = 'page_location') end as landing_page,
    countif(event_name = 'page_view') as page_views
from
    -- 更改為您的bigquery project
    `{project_id}.{dataset_id}.events_*`
where
    -- 設定查詢日期
    _table_suffix between '20230612'
    and format_date('%Y%m%d',date_sub(current_date(), interval 1 day))
group by
    page_title,landing_page
having
    landing_page is not null
order by
    page_views desc