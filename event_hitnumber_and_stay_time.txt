SELECT
  user_pseudo_id,
  event_date,
  TIMESTAMP_DIFF( TIMESTAMP_MICROS(nextPageViewTime), TIMESTAMP_MICROS(event_timestamp), second) AS stay_time,
  pageVisitNumber,
  (
  SELECT
    value.string_value
  FROM
    UNNEST(event_params)
  WHERE
    KEY = 'page_title') AS page_title
FROM (
  SELECT
    ROW_NUMBER() OVER (PARTITION BY user_pseudo_id ORDER BY user_pseudo_id, event_timestamp) AS pageVisitNumber,
    LEAD(event_timestamp, 1) OVER (PARTITION BY user_pseudo_id ORDER BY event_timestamp ASC) AS nextPageViewTime,
    *
  FROM
    -- 更改為您的bigquery project
    `{project_id}.{dataset_id}.events_*`
  WHERE
    event_name = "page_view"
  ORDER BY
    user_pseudo_id,
    event_timestamp )